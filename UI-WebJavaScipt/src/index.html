<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="refresh" content="600">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>nitbotUI for IOT</title>

	<meta name="description" content="User Interface untuk perangkat IOT, nitbot-iot, by nitbot-iot team :)">
	<meta name="author" content="nitbot.com">

	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">

	<script type="text/javascript" src="js/jstorage.js"></script>
	<script>
		var japikey = '005d9063bc2a1cb4999ef67391f2ba42';
		var jemail = 'nitbot@nitbot.com';
		var jsuhu = 28, jkelembapan = 60, jreadon = 0;

		function simpanAPIkey(form){
			japikey = form.APIkey.value;
			jemail = form.email.value;
			console.log('APIkey',japikey);
			console.log('Email',jemail);
			document.getElementById("loginFlag").className = "bg-success";
		}

		function reqDataFromServer(varon) {
			var sisip = "";
			switch(varon) {
				case 0:
				sisip='readon';
				break;
				case 1:
				sisip='readon';
				break;
				case 2:
				sisip='readon';
				break;
				case 3:
				sisip='readon';
				break;
				case 4:
				sisip='readon';
				break;
				case 5:
				sisip='readon';
				break;
				case 6:
				sisip='readon';
				break;
				case 7:
				sisip='readon';
				break;
				case 8:
				sisip='readon';
				break;
				case 9:
				sisip='suhu';
				break;
				case 10:
				sisip='kelembapan';
				break;
				default:
				break;
			}
			var request = new XMLHttpRequest();

			request.open('GET', 'http://api.geeknesia.com/api/attribute/'+sisip+'?api_key=005d9063bc2a1cb4999ef67391f2ba42');

			request.onreadystatechange = function () {
				var ubclass="default";
				var flagOn="";
				if (this.readyState === 4) {
					console.log('Status:', this.status);
					console.log('Headers:', this.getAllResponseHeaders());
					console.log('Body:', this.responseText);
					objt=jQuery.parseJSON(this.responseText);
					switch(varon) {
						case 0:
						console.log('isi:',objt.output.attribute.readon);
						flagOn = objt.output.attribute.readon;
						ubclass = "breset";
						break;
						case 1:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 1;
						console.log('flagon1:',flagOn);
						ubclass = "bon1";
						break;
						case 2:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 2;
						console.log('flagon2:',flagOn);
						ubclass = "bon2";
						break;
						case 3:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 4;
						console.log('flagon3:',flagOn);
						ubclass = "bon3";
						break;
						case 4:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 8;
						console.log('flagon4:',flagOn);
						ubclass = "bon4";
						break;
						case 5:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 16;
						console.log('flagon5:',flagOn);
						ubclass = "bon5";
						break;
						case 6:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 32;
						console.log('flagon6:',flagOn);
						ubclass = "bon6";
						break;
						case 7:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 64;
						console.log('flagon7:',flagOn);
						ubclass = "bon7";
						break;
						case 8:
						jreadon = parseInt(objt.output.attribute.readon);
						flagOn = jreadon & 128;
						console.log('flagon8:',flagOn);
						ubclass = "bon8";
						break;
						case 9:
						console.log('isi:',objt.output.attribute.suhu);
						jsuhu=parseInt(objt.output.attribute.suhu);
						document.getElementById("suhu").innerHTML = objt.output.attribute.suhu;
						break;
						case 10:
						console.log('isi:',objt.output.attribute.kelembapan);
						jkelembapan=parseInt(objt.output.attribute.kelembapan);
						document.getElementById("kelembapan").innerHTML = objt.output.attribute.kelembapan;
						break;
						default:
						break;
					}
					if (flagOn===0) 
					{
						document.getElementById(ubclass).className = "danger";
					}
					else 
					{
						document.getElementById(ubclass).className = "success";
					}
				}
			};
			request.send();
		}
		function setData2Server(varon, onoff) {
			var request = new XMLHttpRequest();
			switch(varon) {
				case 0:
					if (onoff) jreadon=0;
					else jreadon=0;
				break;
				case 1:
					if (onoff){ 
						jreadon |=1;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~1; 
						console.log('jreadon',jreadon);}
				break;
				case 2:
					if (onoff){ 
						jreadon |=2;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~2; 
						console.log('jreadon',jreadon);}
				break;
				case 3:
					if (onoff){ 
						jreadon |=4;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~4; 
						console.log('jreadon',jreadon);}
				break;
				case 4:
					if (onoff){ 
						jreadon |=8;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~8; 
						console.log('jreadon',jreadon);}
				break;
				case 5:
					if (onoff){ 
						jreadon |=16;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~16; 
						console.log('jreadon',jreadon);}
				break;
				case 6:
					if (onoff){ 
						jreadon |=32;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~32; 
						console.log('jreadon',jreadon);}
				break;
				case 7:
					if (onoff){ 
						jreadon |=64;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~64; 
						console.log('jreadon',jreadon);}
				break;
				case 8:
					if (onoff){ 
						jreadon |=128;
						console.log('jreadon',jreadon);}
					else {
						jreadon &=~128; 
						console.log('jreadon',jreadon);}
				break;
				default:
				break;
			}
			request.open('GET', 'http://api.geeknesia.com/api/data?api_key='+japikey+'&attributes=%7B'+
				'%22suhu%22%3A'				+jsuhu+
				'%2C%22kelembapan%22%3A'	+jkelembapan+
				'%2C%22readon%22%3A'		+jreadon+
				'%7D');

			request.onreadystatechange = function () {
				if (this.readyState === 4) {
					console.log('Status:', this.status);
					console.log('Headers:', this.getAllResponseHeaders());
					console.log('Body:', this.responseText);
				}
			};

			request.send();
		}
		function oneClick(varmana,data)
		{
			setData2Server(varmana,data);
			reqDataFromServer(varmana);
		}
		function resetAll()
		{
			oneClick(0,0);
			reqDataFromServer(9);
			reqDataFromServer(10);
			reqDataFromServer(1);
			reqDataFromServer(2);
			reqDataFromServer(3);
			reqDataFromServer(4);
			reqDataFromServer(5);
			reqDataFromServer(6);
			reqDataFromServer(0);
		}
	</script>
</head>

<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<div class="jumbotron well">
					<h2>
						Selamat Datang di nitbot-UI
					</h2>
					<p>
						User Interface ini digunakan sebagai sarana pengendalian perangkat nitbot-iot dari Jauh menggunakan koneksi internet.
					</p>
					<p id="loginFlag" class="bg-danger">
						Konfigurasikan email dan APIkey terlebih dahulu pada button warna biru.
					</p>
					<h2>Suhu </h2><h2 id="suhu">masih ambil data, tungguin sebentar</h2>
					<h2>Kelembapan </h2><h2 id="kelembapan">masih ambil data, tungguin sebentar</h2>
				</div>
				<div class="col-md-3">
					<a id="modal-535218" href="#modal-container-535218" role="button" class="btn btn-primary" data-toggle="modal">Email dan APIkey Setting...</a>
					<div class="modal fade" id="modal-container-535218" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
										Ã—
									</button>
									<h4 class="modal-title" id="myModalLabel">
										Isikan email dan APIkey untuk sinkronisasi dg nitbot-iot mu!
									</h4>
								</div>
								<div class="modal-body">
									<form role="form">
										<div class="form-group">
											<label for="exampleInputEmail1">
												Email address
											</label>
											<input name="email" type="email" class="form-control" id="exampleInputEmail1" />
										</div>
										<div class="form-group">
											<label for="exampleInputPassword1">
												API Key
											</label>
											<input name="APIkey" type="password" class="form-control" id="exampleInputPassword1" />
										</div>
										<div class="checkbox">
											<label>
												<input type="checkbox" /> remember me
											</label>
										</div> 
										<button type="button" class="btn btn-default" data-dismiss="modal">
											Close
										</button> 
										<button type="button" class="btn btn-primary" data-dismiss="modal" onClick="simpanAPIkey(this.form);resetAll();">
											Save changes
										</button>
									</form>
								</div>
								<div class="modal-footer">
									<p>by nitbot-iot team</p>
								</div>
							</div>
						</div>
					</div>
				</div>
				<table class="table">
					<thead>
						<tr>
							<th>
								Tekan 2 kali untuk eksekusi | Tombol Eksekusi (hijau = on, merah = off) | Status Hardware dilihat pada background (hijau = on, merah = off)
							</th>
						</tr>
					</thead>
					<tbody>
						<tr id="bon1" class="danger">
							<td>
								<button type="button" class="btn btn-success" onclick="oneClick(1,1);">
									Saklar 1
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-danger" onclick="oneClick(1,0);">
									Saklar 1
								</button>
							</td>
						</tr>
						<tr id="bon2" class="danger">
							<td>
								<button type="button" class="btn btn-success" onclick="oneClick(2,1);">
									Saklar 2
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-danger" onclick="oneClick(2,0);">
									Saklar 2
								</button>
							</td>
						</tr>
						<tr id="bon3" class="danger">
							<td>
								<button type="button" class="btn btn-success" onclick="oneClick(3,1);">
									Saklar 3
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-danger" onclick="oneClick(3,0);">
									Saklar 3
								</button>
							</td>
						</tr>
						<tr id="bon4" class="danger">
							<td>
								<button type="button" class="btn btn-success" onclick="oneClick(4,1);">
									Saklar 4
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-danger" onclick="oneClick(4,0);">
									Saklar 4
								</button>
							</td>
						</tr>
						<tr id="bon5" class="danger">
							<td>
								<button type="button" class="btn btn-success" onclick="oneClick(5,1);">
									Saklar 5
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-danger" onclick="oneClick(5,0);">
									Saklar 5
								</button>
							</td>
						</tr>
						<tr id="bon6" class="danger">
							<td>
								<button type="button" class="btn btn-success" onclick="oneClick(6,1);">
									Saklar 6
								</button>
							</td>
							<td>
								<button type="button" class="btn btn-danger" onclick="oneClick(6,0);">
									Saklar 6
								</button>
							</td>
						</tr>
						<tr id="breset" class="danger">
							<td>
								<button type="button" class="btn btn-danger" onclick="resetAll()">
									RESET ALL
								</button>
							</td>
							<td>
								RESET ALL
							</td>
						</tr>
					</tbody>
				</table> 
			</div>
		</div>
		by nitbot-iot team
	</div>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>
</body>
</html>